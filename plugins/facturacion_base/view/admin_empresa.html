{include="header"}

<div class='container-fluid'>
    <div class="row">
        <div class="col-md-2 col-sm-3"></div>
        <div class="col-md-10 col-sm-9">
            <div class="page-header">
                <h1>
                    <i class="fa fa-building-o" aria-hidden="true"></i>
                    Empresa
                    <a class="btn btn-xs btn-default" href="{$fsc->url()}" title="Recargar la página">
                        <span class="glyphicon glyphicon-refresh"></span>
                    </a>
                </h1>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-2 col-sm-3">
            <ul class="nav nav-pills nav-stacked">
                <li id="b_generales" class="active">
                    <a href="#generales" onclick="mostrar_seccion('');">
                        <span class="glyphicon glyphicon-dashboard"></span> &nbsp; Datos generales
                    </a>
                </li>
                <li id="b_email">
                    <a href="#email" onclick="mostrar_seccion('email');">
                        <span class="glyphicon glyphicon-envelope"></span> &nbsp; Email
                    </a>
                </li>
                <li id="b_facturacion">
                    <a href="#facturacion" onclick="mostrar_seccion('facturacion');">
                        <span class="glyphicon glyphicon-usd"></span> &nbsp; Facturación
                    </a>
                </li>
                <li id="b_cuentasb">
                    <a href="#cuentasb" onclick="mostrar_seccion('cuentasb');">
                        <span class="glyphicon glyphicon-credit-card"></span> &nbsp; Cuentas bancarias
                    </a>
                </li>
                <li id="b_impresion">
                    <a href="#impresion" onclick="mostrar_seccion('impresion');">
                        <span class="glyphicon glyphicon-print"></span> &nbsp; Impresión
                    </a>
                </li>
                {loop="$fsc->extensions"}
                {if="$value->type=='button'"}
                <li>
                    <a href="index.php?page={$value->from}{$value->params}">{$value->text}</a>
                </li>
                {/if}
                {/loop}
            </ul>
        </div>
        <div class="col-md-10 col-sm-9">
            <form name="f_empresa" action="{$fsc->page->url()}" method="post" class="form" role="form">
                <div class="panel panel-primary" id="panel_generales">
                    <div class="panel-heading">
                        <h3 class="panel-title">Datos generales</h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-sm-5">
                                <div class="form-group">
                                    Nombre:
                                    <input class="form-control" type="text" name="nombre" value="{$fsc->empresa->nombre}" autocomplete="off" autofocus />
                                </div>
                            </div>
                            <div class="col-sm-3">
                                <div class="form-group">
                                    Nombre Corto:
                                    <input class="form-control" type="text" name="nombrecorto" value="{$fsc->empresa->nombrecorto}" autocomplete="off"/>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    {#FS_CIFNIF#}:
                                    <input class="form-control" type="text" name="cifnif" value="{$fsc->empresa->cifnif}" maxlength="30" autocomplete="off"/>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-4">
                                <div class="form-group">
                                    Administrador:
                                    <input class="form-control" type="text" name="administrador" value="{$fsc->empresa->administrador}" autocomplete="off"/>
                                </div>
                            </div>
                            <div class="col-sm-2">
                                <div class="form-group">
                                    <a href="{$fsc->pais->url()}">País</a>:
                                    <select name="codpais" class="form-control">
                                        {loop="$fsc->pais->all()"}
                                        {if="$fsc->empresa->codpais==$value->codpais"}
                                        <option value="{$value->codpais}" selected="">{$value->nombre}</option>
                                        {else}
                                        <option value="{$value->codpais}">{$value->nombre}</option>
                                        {/if}
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-3">
                                <div class="form-group">
                                    <span class="text-capitalize">{#FS_PROVINCIA#}:</span>
                                    <input id="ac_provincia" class="form-control" type="text" name="provincia" value="{$fsc->empresa->provincia}"/>
                                </div>
                            </div>
                            <div class="col-sm-3">
                                <div class="form-group">
                                    Ciudad:
                                    <input class="form-control" type="text" name="ciudad" value="{$fsc->empresa->ciudad}" autocomplete="off"/>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-3">
                                <div class="form-group">
                                    Código Postal:
                                    <input class="form-control" type="text" name="codpostal" value="{$fsc->empresa->codpostal}" maxlength="10" autocomplete="off"/>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    Dirección:
                                    <input class="form-control" type="text" name="direccion" value="{$fsc->empresa->direccion}" autocomplete="off"/>
                                </div>
                            </div>
                            <div class="col-sm-3">
                                <div class="form-group">
                                    <span class="text-capitalize">{#FS_APARTADO#}</span>:
                                    <input class="form-control" type="text" name="apartado" value="{$fsc->empresa->apartado}" maxlength="10" autocomplete="off"/>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-4">
                                <div class="form-group">
                                    Teléfono:
                                    <input class="form-control" type="text" name="telefono" value="{$fsc->empresa->telefono}" autocomplete="off"/>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    Fax:
                                    <input class="form-control" type="text" name="fax" value="{$fsc->empresa->fax}" autocomplete="off"/>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    Web:
                                    <input class="form-control" type="text" name="web" value="{$fsc->empresa->web}" autocomplete="off"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-footer text-right">
                        <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true; this.form.submit();">
                            <span class="glyphicon glyphicon-floppy-disk"></span>&nbsp; Guardar
                        </button>
                    </div>
                </div>
                <div id="panel_email">
                    {include="block/admin_empresa_email"}
                </div>
                <div class="panel panel-primary" id="panel_facturacion">
                    {include="block/admin_empresa_facturacion"}
                </div>
                <div class="panel panel-primary" id="panel_impresion">
                    {include="block/admin_empresa_impresion"}
                </div>
            </form>
            <div id="panel_cuentasb">
                {include="block/admin_empresa_bancos"}
            </div>
        </div>
    </div>
</div>

<form enctype="multipart/form-data" action="{$fsc->url()}#impresion" method="post">
    <input type="hidden" name="logo" value="TRUE"/>
    <div class="modal fade" id="modal_logo">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">
                        <span class="glyphicon glyphicon-picture"></span>
                        Logotipo para los documentos
                    </h4>
                </div>
                <div class="modal-body">
                    {if="$fsc->logo"}
                    <div class="thumbnail">
                        <img src="{$fsc->logo}" alt="logotipo"/>
                    </div>
                    {/if}
                    <div class="form-group">
                        <input name="fimagen" type="file" accept="image/jpeg, image/png"/>
                    </div>
                </div>
                <div class="modal-footer">
                    {if="$fsc->logo"}
                    <a class="btn btn-sm btn-danger pull-left" href="{$fsc->url()}&delete_logo=TRUE#impresion">
                        <span class="glyphicon glyphicon-trash"></span>&nbsp; Eliminar
                    </a>
                    {/if}
                    <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true; this.form.submit();">
                        <span class="glyphicon glyphicon-floppy-disk"></span>&nbsp; Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>

<form name="f_nueva_cuenta" action="{$fsc->url()}#cuentasb" method="post" class="form">
    <div class="modal" id="modal_nueva_cuenta">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">
                        <span class="glyphicon glyphicon-credit-card"></span>
                        &nbsp; Nueva cuenta bancaria
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        Descripción:
                        <input class="form-control" type="text" name="descripcion" placeholder="Cuenta principal" autocomplete="off" required=""/>
                    </div>
                    <div class="form-group">
                        <a target="_blank" href="http://es.wikipedia.org/wiki/International_Bank_Account_Number">IBAN</a>:
                        <input class="form-control" type="text" name="iban" maxlength="34" placeholder="ES12345678901234567890123456" autocomplete="off"/>
                    </div>
                    <div class="form-group">
                        <a target="_blank" href="http://es.wikipedia.org/wiki/Society_for_Worldwide_Interbank_Financial_Telecommunication">SWIFT</a> o BIC:
                        <input class="form-control" type="text" name="swift" maxlength="11" autocomplete="off"/>
                    </div>
                    <div class="form-group">
                        Contabilidad:
                        <div class="input-group">
                            <span class="input-group-addon">
                                <i class="fa fa-balance-scale" aria-hidden="true"></i>
                            </span>
                            <input type="text" name="codsubcuenta" class="form-control" maxlength="15" placeholder="subcuenta" autocomplete="off"/>
                        </div>
                        <p class="help-block">
                            Subcuenta asociada para esta cuenta bancaria.
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-sm btn-primary" type="submit">
                        <span class="glyphicon glyphicon-floppy-disk"></span>&nbsp; Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>


<script type="text/javascript">
    function comprobar_url()
    {
        if (window.location.hash.substring(1) == 'email') {
            mostrar_seccion('email');
        } else if (window.location.hash.substring(1) == 'facturacion') {
            mostrar_seccion('facturacion');
        } else if (window.location.hash.substring(1) == 'cuentasb') {
            mostrar_seccion('cuentasb');
        } else if (window.location.hash.substring(1) == 'impresion') {
            mostrar_seccion('impresion');
        } else {
            mostrar_seccion('');
        }
    }
    function mostrar_seccion(id)
    {
        $("#panel_generales").hide();
        $("#panel_email").hide();
        $("#panel_facturacion").hide();
        $("#panel_cuentasb").hide();
        $("#panel_impresion").hide();
        $("#b_generales").removeClass('active');
        $("#b_email").removeClass('active');
        $("#b_facturacion").removeClass('active');
        $("#b_cuentasb").removeClass('active');
        $("#b_impresion").removeClass('active');
        if (id == 'email') {
            $("#panel_email").show();
            $("#b_email").addClass('active');
            document.f_empresa.email.focus();
        } else if (id == 'facturacion') {
            $("#panel_facturacion").show();
            $("#b_facturacion").addClass('active');
            document.f_empresa.coddivisa.focus();
        } else if (id == 'cuentasb') {
            $("#panel_cuentasb").show();
            $("#b_cuentasb").addClass('active');
        } else if (id == 'impresion') {
            $("#panel_impresion").show();
            $("#b_impresion").addClass('active');
            document.f_empresa.pie_factura.focus();
        } else {
            $("#panel_generales").show();
            $("#b_generales").addClass('active');
            document.f_empresa.nombre.focus();
        }
    }
    function delete_cuenta(id)
    {
        bootbox.confirm({
            message: '¿Realmente desea eliminar la cuenta bancaria #' + id + '?',
            title: '<b>Atención</b>',
            callback: function (result) {
                if (result) {
                    window.location.href = '{$fsc->url()}&delete_cuenta=' + id + '#cuentasb';
                }
            }
        });
    }
    $(document).ready(function () {
        comprobar_url();
        window.onpopstate = function () {
            comprobar_url();
        };
        $("#b_nueva_cuenta").click(function (event) {
            event.preventDefault();
            $("#modal_nueva_cuenta").modal('show');
            document.f_nueva_cuenta.descripcion.focus();
        });
        $("#b_add_logo").click(function (event) {
            event.preventDefault();
            $("#modal_logo").modal('show');
        });
    });
    $("input[name='codsubcuenta']").each(function () {
        $(this).autocomplete({
            serviceUrl: 'index.php?page=admin_empresa',
            paramName: 'subcuenta',
            onSelect: function (data) {
                $(this).val(data.data);
            }
        });
    });
</script>
<script type="text/javascript" src="{$fsc->get_js_location('provincias.js')}"></script>

{include="footer"}